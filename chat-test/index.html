<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>server test</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
  </head>
  <body style="display: flex; justify-content: center; align-items: center;">
    <div id="childwrapper">
      <div id="body">
        <div id="display"></div>
      </div>
      <div id="footer">
        <div class="div"><p id="label1">Message:</p></div>
        <div class="div"><input type="text" id="message"></div>
        <div class="div"><button id="send" onclick="send()">send</button></div>
        <div class="div"><p id="label2">Room ID:</p></div>
        <div class="div"><input type="text" id="roomId"></div>
        <div class="div"><button id="join">join</button></div>
      </div>
    </div>
    <script type="module">
      import { io } from '/node_modules/socket.io-client/dist/socket.io.esm.min.js';

      //Set up connection to server
      const socket = io("http://localhost:3000");
      socket.on('connect', () => {
        send(`you connected with id ${socket.id}`,false,false);
      })
      
      //idk what to label this part as
      
      const roomInput = document.getElementById("roomId");
      const joinInput = document.getElementById("join");
      let room = "";
      
      //Send function, responsible for sending messages, duh
      
      function send(message = document.getElementById('message').value, publicMessage = true, self = true){
        let newMessage = document.createElement("p");
        newMessage.className = "message";
        if (self){
          newMessage.innerHTML = "You: " + message;
        } else {
          newMessage.innerHTML = message;
        }
        document.getElementById("display").appendChild(newMessage);
        if (publicMessage){
          socket.emit('send', message, room);
        }
      }
      window.send = send;
      
      //join function, responsible for connecting with a certain client
      
      joinInput.addEventListener('click', () => {
        let joinId = document.getElementById("roomId").value;
        let newJoin = document.createElement("p");
        newJoin.className = "joinMessage";
        newJoin.innerHTML = "You joined room: " + joinId;
        document.getElementById("display").appendChild(newJoin);
        room = roomInput.value;
        socket.emit('join', room)
      })
      
      window.join = join;
      
      //Message reviever
      
      socket.on('recieve', (message,self) => {
        send(message, false, self);
      })
    </script>
  </body>
</html>
